---
layout: post
title: GPG Guide
author: Luca Fluri
published: false
---
**[Last Updated: 2022-01-05]**

**WORK IN PROGRESS**

# GPG in General
**GPG** aka **GnuPG** aka **Gnu Privacy Guard**  
**GNU**: a recursive acronym meaning "_**GNU's not Unix!_**")  
  
GPG (OpenPG) is the adaption of the encryption standard known as PGP (Pretty Good Privacy). It is mainly designed to use asymmetric public/private key cryptography but also has the option to symmetrically encrypt data. 

# Symmetric vs Asymmetric

# Install
- Windows: [gpg4win](https://www.gpg4win.org/get-gpg4win.html)  
- MacOS: `brew install gpg pinentry-mac`  
- Linux: `sudo apt-get install gnupg`  

On Windows most of the following functionality can be handled via the installed gpg4win GUI application called Kleopatra.

## Verify Installation
In this guide GnuPG version `2.3.4` was used.
``` shell
gpg --version
```

# Managing Key Pairs
## Creating a Key Pair
```shell
gpg --full-gen-key
```
You will be prompted several things:
1. Keypair kind (RSA & RSA or ECC are the 2 most likely options for you)
2. Keysize (RSA), Elliptic Curve (ECC)
3. Expiration Date for the key (this can be extended manually later on, so picking a key with an expiration is the safest option in case you lose the key)
4. Name and email address
5. Comment
6. Passphrase: Choose a secure password to protect your key

## List All Keys
``` shell
// List public keys only
gpg --list-keys
or
gpg -k

// List all private keys available
gpg --list-secret-keys 
or
gpg -K
```

```shell
gpg --fingerprint [KEYID]      //without KEYID supplied it will list all fingerprints
```


## Deleting Keys
```shell
gpg --delete-key KEYID
gpg --delete-secret-key KEYID
```
KEYID can be anything that identifies the key like the name of the owner, email, fingerprint etc.

## Exporting Keys
```shell
-a = --armor (ASCII instead of Binary)
-o = --ouptut

// Public
gpg --export -a -o PUBLIC.asc KEYID

// Private
gpg --export-secret-keys -a -o PRIVATE.asc KEYID
```
Without --output specified gpg will print to stdout

## Importing Keys
```shell 
// Public (your own or someone elses)
gpg --import PUBLIC.key

// Private
gpg --allow-secret-key-import --import PRIVATE.asc
```

## Public Key Servers 
-   [pgp.mit.edu](http://pgp.mit.edu/)
-   [keyserver.ubuntu.com](https://keyserver.ubuntu.com/)
-   [keyserver.pgp.com](https://keyserver.pgp.com/)
-   [peegeepee.com](https://peegeepee.com/)
- etc.

### Publish Public Key
```shell
gpg --send-keys --keyserver hkp://KEYSERVER KEYID
```
### Search Public Keys
```shell
gpg --keyserver hkp://KEYSERVER --search USER@DOMAIN.COM
```

Where KEYSERVER is the address of the key server like: pgp.mit.edu

## Editing Keys
```shell
gpg --edit-key KEYID
```
A interactive gpg prompt will start, get all command by entering `help`

### Examples
#TODO 


## Key Trust Levels
#TODO 

### Signing Public Keys
``` shell
gpg --sign-key recipient@email.com
```
### Show Fingerprint of Public Key
In order to verify the key manually, you can compare the local fingerprint of the public key with a the fingerprint of the same key provided directly and securely by the recipient itself.
``` shell
gpg --fingerprint recipient@email.com
```


# Encrypting Files
## Symmetric
```shell
-c = --symmetric (encrypt)
-o = --output (optional)

gpg -c [--cipher-algo AES256] [-o OUTPUT] INPUT
```
The default symmtric cipher in gpg 2.3 is AES-256 so passing the `--cipher-algo` flag is unnecessary unless you want to use something else or be sure.
Alternatively you can also set `--cipher-algo AES256` in your `gpg.conf` file or in the command line so you don't have to specify it everytime

Using AES-256 will use the CFB block cipher mode internally.

## Asymmetric
```shell
-e = --encrypt (asymmetric)
-r = --recipient
-o = --output (optional)

gpg -e -r KEYID [-o OUTPUT] INPUT
```

If you don't supply the `-o` output file flag, gpg will create a new file with the same filename + `.gpg` appended (`.asc` if ascii armored output)

## Decrypting Files
This works for both symmetrically and asymmetrically encrypted files
```shell
-d = --decrypt
-o = --output (optional)

gpg -d -o OUTPUT INPUT
or
gpg INPUT (will decrypt and save to filename without .gpg or .asc ending)

```
Not having an output file specified will result in gpg printing to stdout.


## ASCII Armor
Normally encrypted data and exports will be binary. If you intend to send the encrypted data over the internet (email etc.) to someone it has to be in ASCII form. Use the `-a` flag which stands for `--armor` to have an ASCII output.

Simply storing data on a NAS or never having to paste it somewhere doesn't require the `--armor` flag.

Using ASCII armor will results in bigger files and longer encryption times:
> We do not recommend using the --armour option for encrypting files that will be transferred to/from NAS systems. This option is mainly intended for sending binary data through email, not via transfer commands such as bbftp or ftp. The file size tends to be about 33% bigger than without this option, and encrypting the data takes about 10-15% longer.

Quote by [NASA's guide for GPG file encryption](https://www.nas.nasa.gov/hecc/support/kb/using-gpg-to-encrypt-your-data_242.html)


# tar Archive Guide
```shell
-c create
-x extract
-f filename
-z gzip compression
-j bzip compression
-v verbose

// Create .tar archive
tar -cf archive.tar FOLDER/ [optional more files]


// Extract .tar
tar -xf archive.tar [-C extractFolder]

// Create gzipped archives
tar -czf archive.tar.gz FOLDER/


// Extract gzipped
tar -xzf archive.tar.gz


//List Contents:
tar -tvf archive.tar

```


# Signing Data

## Verify Signatures

# GPG-Agent Cache
While playing around locally, encrypting and decrypting files you might have noticed that the password for keys gets cached locally for a short time. This of course has the advantage that you don't have to enter the key all the time. The cache gets cleared periodically or when restarting of course.

If you want to clear the cache manually:
```shell
gpg-connect-agent reloadagent /bye
```


# Subkeys

# Handling Private Keys

# Backup
## Restore





# References and Sources
- [https://github.com/bfrg/gpg-guide](https://github.com/bfrg/gpg-guide)
- [https://www.nas.nasa.gov/hecc/support/kb/using-gpg-to-encrypt-your-data_242.html](https://www.nas.nasa.gov/hecc/support/kb/using-gpg-to-encrypt-your-data_242.html)
- 